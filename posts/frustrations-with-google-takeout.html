<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frustrations with Google Takeout</title>
    <style>
        :root {
            /* Light Mode */
            --background-color: white;
            --text-color: black;
            --link-color: blue;
            --visited-link-color: purple;
            --hover-link-color: darkorange;
            --active-link-color: red;

            /* Post Entries */
            --post-date-color: gray;
            --post-title-color: black;
            --post-tags-color: blue;

            /* Code Block */
            --code-background: #f5f5f5;
            --code-text: #333333;
            --code-keyword: #0000ff;
            --code-operator: #000000;
            --code-punctuation: #333333;
            --code-special-bg: #ffffc0;
            --code-special-text: #000000;
            --code-highlight-line: #ffffcc;
            --code-whitespace: #c0c0c0;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* Dark Mode */
                --background-color: black;
                --text-color: white;
                --link-color: #1E90FF;
                --visited-link-color: #9370DB;
                --hover-link-color: #FFD700;
                --active-link-color: #FF4500;

                /* Post Entries */
                --post-date-color: #cccccc;
                --post-title-color: white;
                --post-tags-color: #1E90FF;

                /* Code Block */
                --code-background: #171717;
                --code-text: #e0e0e0;
                --code-keyword: #ffffff;
                --code-operator: #ffffff;
                --code-punctuation: #ffffff;
                --code-special-bg: #ffffc0;
                --code-special-text: #000000;
                --code-highlight-line: #ffffcc;
                --code-whitespace: #c0c0c0;
            }
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px;
            margin: 0 auto;
            max-width: 60em;
        }

        .navbar {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            padding: 0.5em;
        }

        .post-list {
            width: 100%;
        }

        .post-entry {
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0.5em 0;
        }

        .post-date {
            color: var(--post-date-color);
            text-align: left;
        }

        .post-title {
            color: var(--post-title-color);
            margin-left: 1em;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .post-tags {
            flex: 0 0 10em;
            text-align: right;
            margin-left: auto; /* push text to the right */
        }

        a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:visited {
            color: var(--visited-link-color);
        }

        a:hover {
            color: var(--hover-link-color);
            text-decoration: underline;
        }

        a:active {
            color: var(--active-link-color);
        }

        /* Code Blocks */
        pre {
            line-height: 125%;
        }

        .codehilite {
            background: var(--code-background);
            color: var(--code-text);
        }

        .codehilite .k {
            color: var(--code-keyword);
            font-weight: bold;
        }

        .codehilite .o {
            color: var(--code-operator);
            font-weight: bold;
        }

        .codehilite .p {
            color: var(--code-punctuation);
            font-weight: bold;
        }

        .codehilite .hll {
            background-color: var(--code-highlight-line);
        }

        .codehilite .w {
            color: var(--code-whitespace);
        }
    </style>
</head>
<body>

<h1>Frustrations with Google Takeout</h1>

<p><i>Problems I experienced with Google Takeout and how I worked around them</i></p>

<p>When I purchased the mulcahy.ca domain name I thought it would be a good idea
to use Google Apps For Your Domain. Basically I got something that looked like
a normal Google account - gmail, etc - but my login was <em>[redacted]</em>@mulcahy.ca
instead of <em>[redacted]</em>@gmail.com. There were some frustrations over the years,
but I was able to live with them. My takeaway from the experience is that it's
better to use the mass market product than a niche product. If you want things
to just work choose Toyota over Ferrari.</p>
<p>Google Apps For Your Domain went through multiple renames and each rename
seemed to come with a price increase. I found some details
<a href="https://www.lexnetcg.com/blog/google-workspace/brief-history/">here</a>. I don't
believe I had ever used the free product - maybe I was initially paying
$50/year. Now the product is called Google Workspace and I'm paying $40 - per
month! The cost has increased by nearly 10x. It seems to be aimed at small
business owners rather than hobbyists.</p>
<p>I host my blog for free on Github Pages and my domain registrar provides email
forwarding for $5/year, so I've wanted to leave Google Workspace and save some
money for a long time. In theory, it should be easy. Google Takeout advertises
the ability to download all of your data. In practice, not so much.</p>
<h2>Takeout Problem #1: Incomplete data</h2>
<p>The data I downloaded from takeout was incomplete. <a href="https://www.reddit.com/r/googlephotos/comments/1cx0tds/please_dont_use_google_photos_and_google_takeout/">Apparently I'm not the only
one</a>.
I downloaded folders from Google Drive and some files in subfolders were
missing. This is a big problem for me because I have important records I can't
lose. I'm fortunate that I noticed a problem before deleting the original data.</p>
<h2>Takeout Problem #2: Missing metadata</h2>
<p>When I used takeout to download photos from Google Photos the timestamps were
missing. This was a big problem for me because my photos of my children as
babies were in my Google Workspace account. I really wanted to know when each
photo was taken.</p>
<h2>Takeout Problem #3: File conversion</h2>
<p>I had lots of gdocs and Takeout automatically converted them to docx. Some of
the file/folder names got changed slightly. This is not as much of a
deal-breaker as the first two, but it still makes me unhappy. I wanted to
re-upload the takeout files into my personal Gmail account, so they should be
able to remain as gdocs. Although this whole debacle makes me question whether
I should be using gdocs. I will defer that to a later time.</p>
<h2>Google Photos Solution</h2>
<p>I used "Partner Sharing" to share all of my photos with my personal Gmail
account, and then in that personal account I chose to save all photos to my
account. This worked quite well and really wasn't too hard. The only thing I
didn't like is that it didn't tell me when sharing was complete, so I don't
really know when it's safe to delete the originals, but probably it's okay a
day later? Make sure you choose the option to save the shared photos to your
account.</p>
<h2>Google Drive Solution</h2>
<p>I couldn't find an easy solution for Google Drive. There is a setting to
transfer ownership but it doesn't allow you to transfer outside of your
"organization". You can share folders with people outside of your organization,
but you can't transfer ownership.</p>
<p>I also tried syncing data with Google Drive for Desktop and then manually
copying. This lost the gdrive-native files, like gdoc. The problem is that
these are synced as pointers to the original files, which are owned by my
workspace account.</p>
<p>I moved all of my content into a folder named to-share and shared that with my
personal account. Then I had ChatGPT write me some Python to copy that folder
recursively. I had to generate a credentials.json file which was annoying and
I'd rather not have done with my personal account. But I'll delete the
credentials after the operation is complete.</p>
<p>ChatGPT's code kind of worked, but I had to tweak it to preserve file name and
metadata. And then I noticed that it was only copying the first 100 files in
large folders, so I had to change it to handle pagination. It's worthwhile
double-checking the results. Here's the code in case it helps someone else.</p>
<p>I find it absurd how difficult this is, but I think it's unlikely there was any
ill intent. Google probably made the decision to not allow ownership transfer
outside of the organization because it'd be rather catastrophic if you
transferred ownership accidentally.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">google.auth</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">google.auth.transport.requests</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Request</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">google.oauth2.credentials</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Credentials</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">google_auth_oauthlib.flow</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">InstalledAppFlow</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">googleapiclient.discovery</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">build</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">googleapiclient.http</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">MediaIoBaseDownload</span>

<span class="c1"># If modifying or deleting the scope later, delete the token.json file to revoke the old one</span>
<span class="n">SCOPES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;https://www.googleapis.com/auth/drive&#39;</span><span class="p">]</span>

<span class="c1"># Authenticate and create the service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">():</span>
<span class="w">    </span><span class="s2">&quot;&quot;&quot;Authenticate and return the service.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">creds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span>
<span class="w">    </span><span class="c1"># The file token.json stores the user&#39;s access and refresh tokens, and is created automatically when the authorization flow completes for the first time.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="n">creds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_authorized_user_file</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SCOPES</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># If there are no (valid) credentials available, let the user log in.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">creds</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">creds</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">creds</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">creds</span><span class="o">.</span><span class="n">expired</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">creds</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
<span class="w">            </span><span class="n">creds</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">Request</span><span class="p">())</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="n">flow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InstalledAppFlow</span><span class="o">.</span><span class="n">from_client_secrets_file</span><span class="p">(</span>
<span class="w">                </span><span class="s1">&#39;credentials.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SCOPES</span><span class="p">)</span>
<span class="w">            </span><span class="n">creds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flow</span><span class="o">.</span><span class="n">run_local_server</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
<span class="w">        </span><span class="c1"># Save the credentials for the next run</span>
<span class="w">        </span><span class="k">with</span><span class="w"> </span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;token.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">token</span><span class="p">:</span>
<span class="w">            </span><span class="n">token</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">creds</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>

<span class="w">    </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;v3&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">service</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_folder_contents</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">folder_id</span><span class="p">):</span>
<span class="w">    </span><span class="s2">&quot;&quot;&quot;Get all files and subfolders in a folder, handling pagination.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="n">page_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="kc">True</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># List the files in the folder, handling pagination with page_token</span>
<span class="w">        </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
<span class="w">            </span><span class="n">q</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">folder_id</span><span class="si">}</span><span class="s2">&#39; in parents&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">fields</span><span class="o">=</span><span class="s2">&quot;nextPageToken, files(id, name, mimeType)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">pageToken</span><span class="o">=</span><span class="n">page_token</span>
<span class="w">        </span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="w">        </span><span class="c1"># Add the files from this page to the list of items</span>
<span class="w">        </span><span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span>

<span class="w">        </span><span class="c1"># Check if there is another page of results</span>
<span class="w">        </span><span class="n">page_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nextPageToken&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">page_token</span><span class="p">:</span>
<span class="w">            </span><span class="k">break</span><span class="w">  </span><span class="c1"># No more pages, exit the loop</span>

<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;returning </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">items</span>

<span class="k">def</span><span class="w"> </span><span class="nf">copy_file</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">file_id</span><span class="p">,</span><span class="w"> </span><span class="n">folder_id</span><span class="p">):</span>
<span class="w">    </span><span class="s2">&quot;&quot;&quot;Copy a file to the new folder, preserving the original file name.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="c1"># Get the file&#39;s metadata to preserve its original name</span>
<span class="w">    </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fileId</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="w">    </span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="w">    </span><span class="c1"># Prepare the metadata for the copy operation</span>
<span class="w">    </span><span class="n">file_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">file_name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;parents&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">folder_id</span><span class="p">]}</span>

<span class="w">    </span><span class="c1"># Copy the file to the new folder</span>
<span class="w">    </span><span class="n">copied_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">fileId</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="n">file_metadata</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copied file: </span><span class="si">{</span><span class="n">copied_file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - original_id=</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">, new_id=</span><span class="si">{</span><span class="n">copied_file</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, mimeType=</span><span class="si">{</span><span class="n">copied_file</span><span class="p">[</span><span class="s1">&#39;mimeType&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">copied_file</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">copied_file</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

<span class="c1"># After copying the file, restore timestamps</span>
<span class="k">def</span><span class="w"> </span><span class="nf">restore_timestamps</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">copied_file_id</span><span class="p">,</span><span class="w"> </span><span class="n">original_file_id</span><span class="p">):</span>
<span class="w">    </span><span class="n">original_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fileId</span><span class="o">=</span><span class="n">original_file_id</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="s1">&#39;createdTime, modifiedTime&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="w">    </span><span class="n">created_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">original_file</span><span class="p">[</span><span class="s1">&#39;createdTime&#39;</span><span class="p">]</span>
<span class="w">    </span><span class="n">modified_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">original_file</span><span class="p">[</span><span class="s1">&#39;modifiedTime&#39;</span><span class="p">]</span>

<span class="w">    </span><span class="c1"># Update the copied file&#39;s timestamps (Google Drive doesn&#39;t allow setting createdTime directly, but we can update modifiedTime)</span>
<span class="w">    </span><span class="n">updated_file_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;modifiedTime&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">modified_time</span><span class="p">}</span>
<span class="w">    </span><span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fileId</span><span class="o">=</span><span class="n">copied_file_id</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="n">updated_file_metadata</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Restored timestamps for copied file </span><span class="si">{</span><span class="n">copied_file_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Copy a folder</span>
<span class="k">def</span><span class="w"> </span><span class="nf">copy_folder</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">source_folder_id</span><span class="p">,</span><span class="w"> </span><span class="n">destination_folder_id</span><span class="p">):</span>
<span class="w">    </span><span class="s2">&quot;&quot;&quot;Recursively copy a folder and its contents.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="c1"># First, copy all files in the folder</span>
<span class="w">    </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_folder_contents</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">source_folder_id</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">items</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;mimeType&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;application/vnd.google-apps.folder&#39;</span><span class="p">:</span><span class="w">  </span><span class="c1"># If it&#39;s a folder</span>
<span class="w">            </span><span class="c1"># Create the folder in the destination</span>
<span class="w">            </span><span class="n">folder_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;mimeType&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;application/vnd.google-apps.folder&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;parents&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">destination_folder_id</span><span class="p">]}</span>
<span class="w">            </span><span class="n">new_folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">folder_metadata</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="s1">&#39;id, name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="w">            </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created folder: </span><span class="si">{</span><span class="n">new_folder</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">restore_timestamps</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">copied_file_id</span><span class="o">=</span><span class="n">new_folder</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">original_file_id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="w">            </span><span class="c1"># Recursively copy the contents of this folder</span>
<span class="w">            </span><span class="n">copy_folder</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">new_folder</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="w">        </span><span class="k">else</span><span class="p">:</span>
<span class="w">            </span><span class="c1"># Copy the file to the destination folder</span>
<span class="w">            </span><span class="n">copied_file_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy_file</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">destination_folder_id</span><span class="p">)</span>
<span class="w">            </span><span class="n">restore_timestamps</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">copied_file_id</span><span class="o">=</span><span class="n">copied_file_id</span><span class="p">,</span><span class="w"> </span><span class="n">original_file_id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

<span class="c1"># Main function to copy folder</span>
<span class="k">def</span><span class="w"> </span><span class="nf">copy_drive_folder</span><span class="p">(</span><span class="n">source_folder_id</span><span class="p">,</span><span class="w"> </span><span class="n">destination_folder_id</span><span class="p">):</span>
<span class="w">    </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authenticate</span><span class="p">()</span>
<span class="w">    </span><span class="n">copy_folder</span><span class="p">(</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">source_folder_id</span><span class="p">,</span><span class="w"> </span><span class="n">destination_folder_id</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="vm">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="n">source_folder_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#39;</span><span class="w">  </span><span class="c1"># Replace with your source folder ID</span>
<span class="w">    </span><span class="n">destination_folder_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY&#39;</span><span class="w">  </span><span class="c1"># Replace with your destination folder ID</span>
<span class="w">    </span><span class="n">copy_drive_folder</span><span class="p">(</span><span class="n">source_folder_id</span><span class="p">,</span><span class="w"> </span><span class="n">destination_folder_id</span><span class="p">)</span>
</code></pre></div>

<p>You'll also need to pip install dependencies:</p>
<div class="codehilite"><pre><span></span><code>pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
</code></pre></div>

<h2>Gmail Solution</h2>
<p>I didn't really have much of a problem here because I've been forwarding my
email from my Google Workspace account to my personal account for years. I've
also set up <a href="https://en.wikipedia.org/wiki/OfflineIMAP">OfflineIMAP</a> so I can
keep local copies of my emails.</p>
<h2>Solutions for other Google services</h2>
<p>I don't think I really have anything else there, but I used Google Takeout to
download everything else just in case.</p>

<br>

<p>
    If you enjoyed this post, please let me know on
    <a href="https://twitter.com/tommulcahy">Twitter</a>
    or
    <a href="https://androiddev.social/@tcm">Mastodon</a>.
</p>

<p>
    <i>Posted December 27, 2024.</i>
</p>
<p>
    <i>Tags:</i> <a href="/tags/python.html">#python</a>
</p>

<div class="navbar">
    <a href="/">Index</a>
    <a href="/rss.xml">RSS</a>
    <a href="/about.html">About</a>
</div>

</body>
</html>
